<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PromptPay</title>
    <style>
      table, th, td {
          border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="message">
        <input id="file" type="file" accept="image/*"><br>
        <p id="rawData"></p>
        <table id="table">
          <tr>
            <td>Tag</td>
            <td>Name</td>
            <td>Data</td>
          </tr>
        </table>
        <table id="merchant">
          <tr>
            <td>Promptpay Type</td>
            <td id="ppType"></td>
          </tr>
          <tr>
            <td>Promptpay Number</td>
            <td id="ppNumber"></td>
          </tr>
        </table>
    </div>
    <!-- qrcode reader -->
    <script type="text/javascript" src="js/jsqrcode/grid.js"></script>
    <script type="text/javascript" src="js/jsqrcode/version.js"></script>
    <script type="text/javascript" src="js/jsqrcode/detector.js"></script>
    <script type="text/javascript" src="js/jsqrcode/formatinf.js"></script>
    <script type="text/javascript" src="js/jsqrcode/errorlevel.js"></script>
    <script type="text/javascript" src="js/jsqrcode/bitmat.js"></script>
    <script type="text/javascript" src="js/jsqrcode/datablock.js"></script>
    <script type="text/javascript" src="js/jsqrcode/bmparser.js"></script>
    <script type="text/javascript" src="js/jsqrcode/datamask.js"></script>
    <script type="text/javascript" src="js/jsqrcode/rsdecoder.js"></script>
    <script type="text/javascript" src="js/jsqrcode/gf256poly.js"></script>
    <script type="text/javascript" src="js/jsqrcode/gf256.js"></script>
    <script type="text/javascript" src="js/jsqrcode/decoder.js"></script>
    <script type="text/javascript" src="js/jsqrcode/qrcode.js"></script>
    <script type="text/javascript" src="js/jsqrcode/findpat.js"></script>
    <script type="text/javascript" src="js/jsqrcode/alignpat.js"></script>
    <script type="text/javascript" src="js/jsqrcode/databr.js"></script>
    <!-- promptpay-emvco-parser -->
    <script type="text/javascript" src="js/promptpay-emvco-parser/tags.js"></script>
    <script type="text/javascript" src="js/promptpay-emvco-parser/app.js"></script>
    <script>
      document.getElementById("file").onchange = function () {
    var reader = new FileReader();

    reader.onload = function (e) {
        // get loaded data and render thumbnail.
        var data = e.target.result;
        qrcode.decode(data);
    };

    qrcode.callback = function(decodedData) {
      var rawData = decodedData;
      // parse promptpay info
      var promptpayInfo = parse(rawData);
      var raw = document.getElementById("rawData");
      raw.innerHTML = "data: " + rawData;
      var table = document.getElementById("table");
      // clear old table value
      table.getElementsByTagName("tbody")[0].innerHTML = table.rows[0].innerHTML;
      var keys = Object.keys(promptpayInfo);
      for(var i=0;i<keys.length;i++) {
        var key = keys[i];
        var data = promptpayInfo[key];
        var row = table.insertRow(i+1);
        var id = row.insertCell(0);
        id.innerHTML = data.id;
        var name = row.insertCell(1);
        name.innerHTML = data.name;
        var value = row.insertCell(2);
        value.innerHTML = data.data;
      }
      // merchant data
      var merchantInfo = promptpayInfo.MerchantAccountInformation.merchantInfo;
      var ppType = document.getElementById("ppType");
      ppType.innerHTML = merchantInfo.promptpayIdType;
      var ppNumber = document.getElementById("ppNumber");
      ppNumber.innerHTML = merchantInfo.promptpayNumber;
    }

    // read the image file as a data URL.
    reader.readAsDataURL(this.files[0]);
    
};
    </script>
  </body>
</html>
